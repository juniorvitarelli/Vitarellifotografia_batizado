<div id="vf-quiz"></div>

<style>
  /* ====== FOR√áA FUNDO + REMOVE BRANCOS DO ELEMENTOR ====== */
  #vf-quiz{
    width: 100% !important;
    margin: 0 !important;
    padding: 0 !important;
    background: transparent !important;
  }

  /* Se o Elementor envolver com divs, isso ajuda a evitar "branco" vazando */
  #vf-quiz, #vf-quiz * { box-sizing: border-box; }

  :root{
    --bg1:#07030f;
    --bg2:#12052a;
    --stroke:rgba(165,102,255,.35);
    --stroke2:rgba(165,102,255,.18);
    --text:#f3f1ff;
    --muted:rgba(243,241,255,.68);
    --purple:#7b2cff;
    --purple2:#5a1cff;
    --green:#22c55e;
    --green2:#16a34a;
    --yellow:#ffd24d;
    --shadow: 0 20px 80px rgba(0,0,0,.55);
    --radius:28px;
  }

  /* ====== TELA CHEIA ====== */
  #vf-quiz .vf-wrap{
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    color:var(--text);

    /* tela cheia */
    min-height: 100vh;
    width: 100%;

    /* centraliza o card */
    display: flex;
    align-items: center;
    justify-content: center;

    /* padding responsivo */
    padding: clamp(16px, 4vw, 48px) !important;

    /* FUNDO (for√ßado) */
    background:
      radial-gradient(1200px 600px at 30% 10%, rgba(123,44,255,.35), transparent 55%),
      radial-gradient(900px 600px at 80% 20%, rgba(34,197,94,.18), transparent 55%),
      radial-gradient(800px 500px at 60% 90%, rgba(123,44,255,.22), transparent 55%),
      linear-gradient(180deg, var(--bg1), var(--bg2)) !important;

    /* garante que nada branco do tema apare√ßa */
    background-color: var(--bg1) !important;
  }

  /* limita largura do card, mas ocupa bem no desktop */
  #vf-quiz .vf-shell{
    width: 100%;
    max-width: 1180px;
  }

  #vf-quiz .vf-card{
    width: 100%;
    background: linear-gradient(180deg, rgba(20,8,47,.92), rgba(10,5,24,.88));
    border: 1px solid var(--stroke2);
    box-shadow: var(--shadow);
    border-radius: var(--radius);
    padding: clamp(18px, 3vw, 34px);
    position: relative;
    overflow:hidden;
  }

  #vf-quiz .vf-card:before{
    content:"";
    position:absolute; inset:-2px;
    background:
      radial-gradient(900px 340px at 30% 15%, rgba(123,44,255,.20), transparent 60%),
      radial-gradient(700px 280px at 70% 30%, rgba(255,210,77,.10), transparent 60%),
      radial-gradient(900px 360px at 50% 95%, rgba(34,197,94,.14), transparent 60%);
    pointer-events:none;
  }

  #vf-quiz .vf-top-pill{ display:flex; justify-content:center; margin-bottom: 18px; }
  #vf-quiz .vf-pill{
    display:inline-flex; align-items:center; gap:10px;
    padding: 10px 16px; border-radius: 999px;
    border: 1px solid var(--stroke);
    background: rgba(123,44,255,.14);
    color: var(--yellow);
    font-weight: 800; letter-spacing: .12em; text-transform: uppercase;
    font-size: 13px; position:relative; z-index:1;
  }

  #vf-quiz .vf-hero{ text-align:center; padding: 12px 0 8px; position:relative; z-index:1; }
  #vf-quiz .vf-hero h1{ margin:0; line-height:1.05; font-size: clamp(38px, 5vw, 70px); font-weight: 900; letter-spacing:-0.02em; }
  #vf-quiz .vf-hero h1 .grad{
    background: linear-gradient(90deg, #7b2cff, #ffd24d);
    -webkit-background-clip:text; background-clip:text; color:transparent;
  }
  #vf-quiz .vf-hero p{ margin:14px auto 0; max-width:820px; color: var(--muted); font-size: clamp(16px, 2vw, 20px); }

  #vf-quiz .vf-big-btn{
    width:100%; border:none; border-radius: 18px;
    padding: 18px; font-size: 20px; font-weight: 900;
    letter-spacing:.05em; text-transform: uppercase;
    color:#fff; cursor:pointer;
    background: linear-gradient(180deg, var(--purple), var(--purple2));
    box-shadow: 0 14px 40px rgba(123,44,255,.28);
    transition: transform .08s ease, filter .12s ease;
    position: relative; z-index:1;
  }
  #vf-quiz .vf-big-btn:hover{ filter: brightness(1.05); }
  #vf-quiz .vf-big-btn:active{ transform: translateY(1px) scale(.995); }
  #vf-quiz .vf-note{ text-align:center; color: rgba(243,241,255,.55); margin-top: 10px; font-size: 14px; position:relative; z-index:1; }

  #vf-quiz .vf-q{ position:relative; z-index:1; }
  #vf-quiz .vf-q h2{ margin:0 0 6px; font-size: clamp(34px, 4vw, 58px); letter-spacing:-0.02em; font-weight: 900; }
  #vf-quiz .vf-q .sub{ color: rgba(243,241,255,.6); margin: 0 0 16px; font-size: 18px; }

  #vf-quiz .vf-options{ display:flex; flex-direction:column; gap:14px; margin-top: 18px; }

  #vf-quiz .vf-opt{
    border: 1px solid var(--stroke);
    background: rgba(123,44,255,.10);
    border-radius: 22px;
    padding: 18px;
    font-size: 22px; font-weight: 800;
    cursor:pointer; color: var(--text);
    text-align:left;
    transition: transform .08s ease, background .12s ease, border-color .12s ease;
  }
  #vf-quiz .vf-opt:hover{ background: rgba(123,44,255,.16); }
  #vf-quiz .vf-opt.selected{
    border-color: rgba(255,210,77,.55);
    background: rgba(123,44,255,.22);
    transform: translateY(-1px);
  }

  #vf-quiz .vf-nav{ display:flex; justify-content:space-between; gap:16px; margin-top: 22px; position:relative; z-index:1; }
  #vf-quiz .vf-btn{
    border-radius: 18px; padding: 16px 18px;
    font-size: 18px; font-weight: 900;
    cursor:pointer;
    border: 1px solid rgba(255,255,255,.14);
    background: rgba(10,5,24,.55);
    color: var(--text);
    min-width: 150px;
  }
  #vf-quiz .vf-btn.primary{ border:none; background: linear-gradient(180deg, rgba(123,44,255,.95), rgba(80,18,255,.95)); opacity: .55; }
  #vf-quiz .vf-btn.primary.enabled{ opacity: 1; }

  #vf-quiz .vf-final-pill{ background: rgba(34,197,94,.12); color: rgba(166,255,205,.95); border-color: rgba(34,197,94,.38); }

  #vf-quiz .vf-grid{ display:grid; grid-template-columns: 1fr 1fr; gap:14px; margin-top:14px; }
  @media(max-width:820px){ #vf-quiz .vf-grid{ grid-template-columns:1fr; } }

  #vf-quiz .vf-field label{ display:block; font-weight:800; color: rgba(243,241,255,.7); margin: 10px 0 8px; }
  #vf-quiz .vf-input{
    width:100%;
    padding: 16px;
    border-radius: 18px;
    border: 1px solid rgba(255,255,255,.14);
    background: rgba(10,5,24,.55);
    color: var(--text);
    font-size: 18px;
    outline: none;
  }
  #vf-quiz .vf-input:focus{ border-color: rgba(255,210,77,.45); box-shadow: 0 0 0 4px rgba(255,210,77,.08); }

  #vf-quiz .vf-msg{
    margin-top: 14px; border-radius: 18px;
    padding: 14px 16px;
    background: rgba(10,5,24,.50);
    border: 1px solid rgba(255,255,255,.12);
    color: rgba(243,241,255,.75);
  }

  #vf-quiz .vf-check{ display:flex; align-items:flex-start; gap:10px; margin-top: 12px; color: rgba(243,241,255,.75); font-weight:700; }
  #vf-quiz .vf-check input{ transform: translateY(3px) scale(1.1); }

  #vf-quiz .vf-cta{
    margin-top: 16px;
    width:100%;
    border:none;
    border-radius: 20px;
    padding: 18px;
    font-size: 20px;
    font-weight: 1000;
    letter-spacing: .04em;
    text-transform: uppercase;
    color: #fff;
    cursor:pointer;
    background: linear-gradient(180deg, rgba(34,197,94,.95), rgba(22,163,74,.95));
    box-shadow: 0 16px 45px rgba(34,197,94,.20);
    position: relative; z-index:1;
  }
  #vf-quiz .vf-cta:disabled{ opacity:.55; cursor:not-allowed; }

  #vf-quiz .vf-small{ text-align:center; color: rgba(243,241,255,.58); margin-top: 10px; font-size:14px; position:relative; z-index:1; }
  #vf-quiz .vf-reset{ margin-top:14px; width:100%; border-radius:20px; padding:16px 18px; font-size:18px; font-weight:900; cursor:pointer; border:1px solid rgba(255,255,255,.14); background: rgba(10,5,24,.55); color: var(--text); }
  #vf-quiz .vf-error{ margin-top:10px; color: rgba(255,210,77,.95); font-weight: 900; }
  #vf-quiz .vf-hidden{ display:none; }
</style>

<script>
(function(){
  const BRAND = "Vitarelli Fotografia";
  const WHATSAPP_NUMBER = "5531988008600";

  // ‚úÖ SEU NOVO LINK DO DEPLOY
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyKkqqGeNuQIDFlcQ1hXrgz_u3_gpUJrtNJRFYWjKp3b-ipOeBpjMkJRRX3e1yuSWVoLQ/exec";

  const steps = [
    { type:"question", title:"Como voc√™ encontrou a Vitarelli?", subtitle:"Selecione uma op√ß√£o",
      options:["Instagram","Indica√ß√£o","Google","Outro"], key:"origem" },

    { type:"question", title:"Quando ser√° o casamento?", subtitle:"Selecione uma op√ß√£o",
      options:["0‚Äì3 meses","3‚Äì6 meses","6‚Äì12 meses","Mais de 1 ano","Ainda n√£o definimos"], key:"quando" },

    { type:"question", title:"Onde ser√° o casamento?", subtitle:"Selecione uma op√ß√£o",
      options:["Belo Vale","Moeda","Piedade dos Gerais","Bonfim","Outro local"], key:"onde" },

    { type:"question", title:"Qual estilo de foto voc√™s mais gostam?", subtitle:"Selecione uma op√ß√£o",
      options:["Natural e espont√¢neo (documental)","Fotos bem direcionadas (editorial)","Um equil√≠brio entre os dois","Ainda n√£o sei, quero orienta√ß√£o"], key:"estilo" },

    { type:"question", title:"O que mais preocupa voc√™s?", subtitle:"Selecione uma op√ß√£o",
      options:["N√£o saber posar","Fot√≥grafo perder momentos importantes","Entrega demorar","Fotos ficarem artificiais","Estourar o or√ßamento"], key:"preocupacao" },

    { type:"question", title:"Qual faixa de investimento voc√™s imaginam?", subtitle:"Selecione uma op√ß√£o",
      options:["At√© R$ 2.500","Entre R$ 2.500 e R$ 4.000","Entre R$ 4.000 e R$ 5.000","Ainda n√£o definimos"], key:"investimento" },

    { type:"final" }
  ];

  const state = {
    screen:"start",
    idx:0,
    answers:{},
    lead:{ nome:"", whatsapp:"", email:"", data:"", consent:true },
    sending:false,
    sendError:""
  };

  const root = document.getElementById("vf-quiz");
  root.innerHTML = `<div class="vf-wrap"><div class="vf-shell"><div class="vf-card" id="vf-card"></div></div></div>`;
  const card = document.getElementById("vf-card");

  function render(){
    if(state.screen === "start") return renderStart();
    const step = steps[state.idx];
    if(step.type === "question") return renderQuestion(step);
    return renderFinal();
  }

  function renderStart(){
    card.innerHTML = `
      <div class="vf-top-pill"><div class="vf-pill">QUIZ R√ÅPIDO ‚Ä¢ ${BRAND}</div></div>
      <div class="vf-hero">
        <h1>Descubra o <span class="grad">pacote ideal</span> pro seu casamento</h1>
        <p>Responda em menos de 60 segundos ‚Ä¢ receba disponibilidade e valores</p>
      </div>
      <div style="margin-top:22px; position:relative; z-index:1;">
        <button class="vf-big-btn" id="vf-start">COME√áAR</button>
        <div class="vf-note">N√£o compartilhamos seus dados com ningu√©m.</div>
      </div>
    `;
    document.getElementById("vf-start").onclick = () => { state.screen="step"; state.idx=0; render(); };
  }

  function renderQuestion(step){
    const totalQuestions = steps.filter(s=>s.type==="question").length;
    const etapa = Math.min(state.idx+1, totalQuestions);
    const selected = state.answers[step.key];

    card.innerHTML = `
      <div class="vf-top-pill"><div class="vf-pill">ETAPA ${etapa} DE ${totalQuestions}</div></div>
      <div class="vf-q">
        <h2>${escapeHtml(step.title)}</h2>
        <div class="sub">${escapeHtml(step.subtitle||"")}</div>

        <div class="vf-options">
          ${step.options.map(opt => `
            <button class="vf-opt ${selected===opt?"selected":""}" data-opt="${escapeAttr(opt)}">${escapeHtml(opt)}</button>
          `).join("")}
        </div>

        <div class="vf-nav">
          <button class="vf-btn" id="vf-back">Voltar</button>
          <button class="vf-btn primary ${selected?"enabled":""}" id="vf-next">Pr√≥ximo</button>
        </div>

        <div class="vf-error ${selected?"vf-hidden":""}" id="vf-err">Selecione uma op√ß√£o para continuar.</div>
      </div>
    `;

    card.querySelectorAll(".vf-opt").forEach(btn=>{
      btn.onclick = () => { state.answers[step.key]=btn.getAttribute("data-opt"); render(); };
    });

    document.getElementById("vf-back").onclick = () => {
      if(state.idx===0){ state.screen="start"; }
      else { state.idx -= 1; }
      render();
    };

    document.getElementById("vf-next").onclick = () => {
      const v = state.answers[step.key];
      if(!v){ document.getElementById("vf-err").classList.remove("vf-hidden"); return; }
      state.idx += 1; render();
    };
  }

  function renderFinal(){
    const msg = "Pelo que voc√™s responderam, o ideal √© uma cobertura h√≠brida (momentos naturais + fotos direcionadas), garantindo espontaneidade sem deixar de ter aquelas fotos cl√°ssicas de √°lbum. Agora vamos verificar se a data est√° dispon√≠vel.";

    card.innerHTML = `
      <div class="vf-top-pill"><div class="vf-pill vf-final-pill">ETAPA FINAL</div></div>
      <div class="vf-q">
        <h2>Para eu te enviar disponibilidade e valores</h2>
        <div class="sub">Complete seus dados (leva ~10s)</div>

        <div class="vf-msg">${escapeHtml(msg)}</div>

        <div class="vf-grid">
          <div class="vf-field">
            <label>Seu nome *</label>
            <input class="vf-input" id="vf-nome" placeholder="Ex: Jos√© Vitarelli J√∫nior" value="${escapeAttr(state.lead.nome)}" />
          </div>
          <div class="vf-field">
            <label>WhatsApp *</label>
            <input class="vf-input" id="vf-whats" placeholder="(31) 98800-8600" value="${escapeAttr(state.lead.whatsapp)}" />
          </div>
        </div>

        <div class="vf-grid">
          <div class="vf-field">
            <label>E-mail *</label>
            <input class="vf-input" id="vf-email" placeholder="seuemail@exemplo.com" value="${escapeAttr(state.lead.email)}" />
          </div>
          <div class="vf-field">
            <label>Data do casamento *</label>
            <input class="vf-input" id="vf-data" placeholder="DD/MM/AAAA" value="${escapeAttr(state.lead.data)}" />
          </div>
        </div>

        <div class="vf-check">
          <input type="checkbox" id="vf-consent" ${state.lead.consent?"checked":""}/>
          <div>Autorizo contato da ${BRAND} com base nos dados enviados.</div>
        </div>

        ${state.sendError ? `<div class="vf-error">${escapeHtml(state.sendError)}</div>` : ""}

        <button class="vf-cta" id="vf-send" ${state.sending?"disabled":""}>
          ${state.sending ? "ENVIANDO..." : "üöÄ VER DISPONIBILIDADE NO WHATSAPP"}
        </button>

        <div class="vf-small">Se preferir, posso enviar tamb√©m por e-mail.</div>
        <button class="vf-reset" id="vf-reset">Refazer quiz</button>
      </div>
    `;

    const nome = document.getElementById("vf-nome");
    const whats = document.getElementById("vf-whats");
    const email = document.getElementById("vf-email");
    const data = document.getElementById("vf-data");
    const consent = document.getElementById("vf-consent");

    whats.addEventListener("input", ()=>{
      const formatted = formatBRPhone(whats.value);
      whats.value = formatted.display;
      state.lead.whatsapp = whats.value;
    });

    data.addEventListener("input", ()=>{
      data.value = formatDateBR(data.value);
      state.lead.data = data.value;
    });

    nome.oninput = ()=> state.lead.nome = nome.value;
    email.oninput = ()=> state.lead.email = email.value;
    consent.onchange = ()=> state.lead.consent = consent.checked;

    document.getElementById("vf-reset").onclick = () => resetAll();

    document.getElementById("vf-send").onclick = async () => {
      state.sendError = "";

      const nomeV = (nome.value||"").trim();
      const emailV = (email.value||"").trim();
      const whatsRaw = (whats.value||"").trim();
      const dataV = (data.value||"").trim();
      const consentV = consent.checked;

      const phone = formatBRPhone(whatsRaw);
      const phoneDigits = phone.digits;

      if(!nomeV) return showErr("Preencha seu nome.");
      if(!isValidEmail(emailV)) return showErr("Digite um e-mail v√°lido.");
      if(!isValidBRPhone(phoneDigits)) return showErr("Digite um WhatsApp v√°lido (ex: (31) 98800-8600).");
      if(!isValidDateBR(dataV)) return showErr("Digite a data no formato DD/MM/AAAA (v√°lida).");
      if(!consentV) return showErr("Marque a autoriza√ß√£o para prosseguir.");

      state.sending = true; render();

      const payload = {
        ts: new Date().toISOString(),
        nome: nomeV,
        whatsapp: phoneDigits,
        whatsapp_formatado: phone.display,
        email: emailV,
        data_casamento: dataV,
        respostas: JSON.stringify(state.answers),
        origem: state.answers.origem || "",
        quando: state.answers.quando || "",
        onde: state.answers.onde || "",
        estilo: state.answers.estilo || "",
        preocupacao: state.answers.preocupacao || "",
        investimento: state.answers.investimento || "",
        page_url: location.href
      };

      const ok = await sendToSheet(payload);

      if(!ok){
        state.sending=false;
        return showErr("Falhou o envio para a planilha. Vou te passar o Apps Script correto (JSONP + permiss√µes).");
      }

      const text =
`Ol√°! Fiz o quiz da ${BRAND} üòä

‚Ä¢ Como encontrei: ${payload.origem}
‚Ä¢ Quando: ${payload.quando}
‚Ä¢ Onde: ${payload.onde}
‚Ä¢ Estilo: ${payload.estilo}
‚Ä¢ Preocupa√ß√£o: ${payload.preocupacao}
‚Ä¢ Investimento: ${payload.investimento}

Nome: ${payload.nome}
Data: ${payload.data_casamento}
E-mail: ${payload.email}`;

      const waUrl = "https://wa.me/" + WHATSAPP_NUMBER + "?text=" + encodeURIComponent(text);
      window.open(waUrl, "_blank", "noopener,noreferrer");

      state.sending=false;
      render();
    };
  }

  function showErr(msg){ state.sendError = msg; render(); }

  function resetAll(){
    state.screen="start";
    state.idx=0;
    state.answers={};
    state.lead={ nome:"", whatsapp:"", email:"", data:"", consent:true };
    state.sending=false;
    state.sendError="";
    render();
  }

  async function sendToSheet(payload){
    // JSONP (evita CORS)
    return new Promise((resolve) => {
      const cbName = "vf_cb_" + Math.random().toString(36).slice(2);
      const script = document.createElement("script");
      const params = new URLSearchParams(payload);
      params.set("callback", cbName);

      window[cbName] = function(resp){
        try{ delete window[cbName]; script.remove(); }catch(e){}
        resolve(resp && (resp.ok === true || resp.status === "ok"));
      };

      script.onerror = function(){
        try{ delete window[cbName]; script.remove(); }catch(e){}
        resolve(false);
      };

      script.src = SCRIPT_URL + "?" + params.toString();
      document.body.appendChild(script);
    });
  }

  function escapeHtml(s){ return String(s||"").replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }
  function escapeAttr(s){ return escapeHtml(s).replace(/"/g,'&quot;'); }

  function isValidEmail(email){ return /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/.test(email); }

  function isValidBRPhone(digits){
    if(!digits) return false;
    const d = digits.replace(/\D/g,"");
    if(!(d.length===10 || d.length===11)) return false;
    const ddd = parseInt(d.slice(0,2),10);
    if(ddd < 11 || ddd > 99) return false;
    if(/^(\d)\1+$/.test(d)) return false;
    return true;
  }

  function formatBRPhone(input){
    const digits = String(input||"").replace(/\D/g,"").slice(0,11);
    let display = digits;
    if(digits.length >= 2){
      const ddd = digits.slice(0,2);
      const rest = digits.slice(2);
      if(rest.length <= 4) display = `(${ddd}) ${rest}`;
      else if(rest.length <= 8) display = `(${ddd}) ${rest.slice(0,4)}-${rest.slice(4)}`;
      else display = `(${ddd}) ${rest.slice(0,5)}-${rest.slice(5)}`;
    }
    return { digits, display };
  }

  function formatDateBR(v){
    const d = String(v||"").replace(/\D/g,"").slice(0,8);
    if(d.length<=2) return d;
    if(d.length<=4) return d.slice(0,2)+"/"+d.slice(2);
    return d.slice(0,2)+"/"+d.slice(2,4)+"/"+d.slice(4);
  }

  function isValidDateBR(v){
    if(!/^\d{2}\/\d{2}\/\d{4}$/.test(v)) return false;
    const [dd,mm,yyyy] = v.split("/").map(n=>parseInt(n,10));
    if(yyyy < 2024 || yyyy > 2038) return false;
    if(mm < 1 || mm > 12) return false;
    if(dd < 1 || dd > 31) return false;
    const dt = new Date(yyyy, mm-1, dd);
    return dt.getFullYear()===yyyy && dt.getMonth()===(mm-1) && dt.getDate()===dd;
  }

  render();
})();
</script>
